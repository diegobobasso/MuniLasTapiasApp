üõ°Ô∏è Documento Institucional ‚Äî Autenticaci√≥n y Acceso
üìå Prop√≥sito
Este documento describe la arquitectura de autenticaci√≥n del sistema de gesti√≥n municipal de Las Tapias, incluyendo protecci√≥n por token, control de roles, expiraci√≥n autom√°tica y trazabilidad institucional. Tambi√©n documenta el flujo de login desde el frontend hasta el backend.

üîê Arquitectura de Autenticaci√≥n
1. Backend
verificarToken.js Middleware que valida el token JWT en cada request. Verifica formato Bearer <token> y firma con JWT_SECRET. Si es v√°lido, guarda req.empleado con los datos del usuario. Si es inv√°lido o vencido, responde con 403.

requireRol.js (opcional) Middleware adicional para proteger rutas por rol (admin, empleado). Se aplica despu√©s de verificarToken. Ejemplo: router.post('/api/empleados', verificarToken, requireRol('admin'), handler)

2. Frontend
authService.js Servicio centralizado en src/services/authService.js. Funciones disponibles:

login(email, password) ‚Üí inicia sesi√≥n, guarda token y usuario

logout() ‚Üí limpia sesi√≥n y redirige

getToken() / getUsuario() ‚Üí acceso a datos actuales

isTokenExpired() ‚Üí detecta expiraci√≥n autom√°tica

router/index.js Usa requireAuth para proteger rutas por rol. Middleware global (router.beforeEach) detecta token vencido y ejecuta logout. Redirige autom√°ticamente a /login si el token no existe o expir√≥.

3. Componentes clave
login.vue Usa authService.login() para iniciar sesi√≥n. Muestra errores institucionales. Redirige seg√∫n rol (admin o empleado).

Header.vue Muestra bot√≥n din√°mico Login / Logout. Muestra nombre del usuario logueado (getUsuario()). Usa authService.logout() para cerrar sesi√≥n.

panelInstitucional.vue Muestra nombre, email y rol del usuario. Filtra m√≥dulos seg√∫n rol (admin, empleado).

gestionVecinos.vue Alta y restauraci√≥n de vecinos. Protegido por token y rol. Usa archivoEntidad.vue para adjuntos.

üìä Tabla de Roles y Permisos
Rol	Acceso a m√≥dulos
admin	Panel institucional, Gesti√≥n de tr√°mites, Sugerencias, Art√≠culos, Empleados
empleado	Panel institucional, Gesti√≥n de tr√°mites, Sugerencias, Vecinos, Inspecciones
vecino	Acceso p√∫blico: Noticias, Ordenanzas, Visita, Contacto, Servicios, Pago pendiente
üîÑ Flujo de Login Institucional
Usuario accede a /login

Ingresa email y contrase√±a institucional

Frontend (login.vue)

Llama a authService.login(email, password)

Muestra mensaje de carga y oculta errores previos

authService.js

Env√≠a POST /api/login con credenciales

Si el backend responde con √©xito:

Guarda token en localStorage

Guarda usuario en localStorage

Devuelve true

Si falla:

Devuelve false

login.vue

Si login() devuelve true:

Obtiene el usuario con getUsuario()

Redirige a /panel (o /admin si el rol es admin)

Si devuelve false:

Muestra mensaje de error institucional

router/index.js

Protege rutas con requireAuth

Verifica token y rol antes de permitir acceso

Middleware global detecta expiraci√≥n autom√°tica y ejecuta logout()

Header.vue

Muestra nombre del usuario logueado

Permite cerrar sesi√≥n manualmente con bot√≥n Logout

üìÑ Recomendaciones
Registrar logouts en el backend para trazabilidad (opcional)

Agregar banners o alertas visuales si el token est√° por vencer

Documentar nuevos roles y permisos en esta misma estructura

Mantener authService.js como √∫nica fuente de verdad para autenticaci√≥n